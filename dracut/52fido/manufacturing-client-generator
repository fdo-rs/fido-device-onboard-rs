#!/bin/bash
# -*- mode: shell-script; indent-tabs-mode: nil; sh-basic-offset: 4; -*-
# ex: ts=8 sw=4 sts=4 et filetype=sh

command -v getarg >/dev/null || . /usr/lib/dracut-lib.sh

set -e

# Generators don't have logging right now
# https://github.com/systemd/systemd/issues/15638
exec 1>/dev/kmsg; exec 2>&1

manufacturing_service_url=$(getarg fido.manufacturing_service_url= ||:)
cat >"/etc/manufacturing-service-url" <<EOF
# Automatically generated by live-generator
MANUFACTURING_SERVICE_URL="${manufacturing_service_url}"
DIUN_PUB_KEY_INSECURE="true"
EOF
fi